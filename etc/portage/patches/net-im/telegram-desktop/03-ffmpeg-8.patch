diff --git a/Telegram/SourceFiles/ffmpeg/ffmpeg_utility.cpp b/Telegram/SourceFiles/ffmpeg/ffmpeg_utility.cpp
index 9ccdb15..5df41ce 100644
--- a/Telegram/SourceFiles/ffmpeg/ffmpeg_utility.cpp
+++ b/Telegram/SourceFiles/ffmpeg/ffmpeg_utility.cpp
@@ -22,6 +22,7 @@ https://github.com/telegramdesktop/tdesktop/blob/master/LEGAL
 #endif // LIB_FFMPEG_USE_QT_PRIVATE_API
 
 extern "C" {
+#include <libavcodec/packet.h>
 #include <libavutil/opt.h>
 #include <libavutil/display.h>
 } // extern "C"
@@ -683,13 +684,13 @@ int DurationByPacket(const Packet &packet, AVRational timeBase) {
 }
 
 int ReadRotationFromMetadata(not_null<AVStream*> stream) {
-	const auto displaymatrix = av_stream_get_side_data(
-		stream,
+	const auto displaymatrix = av_packet_side_data_get(
+		&stream->codecpar->side_data,
 		AV_PKT_DATA_DISPLAYMATRIX,
 		nullptr);
 	auto theta = 0;
 	if (displaymatrix) {
-		theta = -round(av_display_rotation_get((int32_t*)displaymatrix));
+		theta = -round(av_display_rotation_get((int32_t*)displaymatrix->data));
 	}
 	theta -= 360 * floor(theta / 360 + 0.9 / 360);
 	const auto result = int(base::SafeRound(theta));
